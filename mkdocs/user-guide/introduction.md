# Introduction

This section covers the basics of the MoBagel API and how you can utilize MoBagel's platform to improve your IoT devices.

---
## Token
MoBagel's API uses token-based authorizations. Tokens are generated by the users, and the server produces corresponding tokens to verify user identities.

#### How to generate tokens?
As an additional layer of security, tokens are generated only through `SHA256`. A unique token needs to be generated for each request. This is called a One-Time Password (OTP), and the API uses OTPs to validate each request. The OTP token can be generated by:

    token = SHA256( product_id:product_key:device_id:device_key:timestamp )

+ product_id: Your product id
+ product_key: Your product key
+ device_id: Your device id
+ device_key: Your device key
+ timestamp: Your current timestamp in milliseconds (13bytes)

---

## Request
To access the MoBagel API, you first have to set up http headers. Add the following headers to your requests:

+ product_id
+ device_id
+ timestamp
+ token

If you use `POST` method, the Content-Type must be `application/json`, and the post data should follow the format below:

    {
        "data": {
            "field": "value"
        }
    }

**Note:** field will be defined by each API

## Response
For each response, the format will look like:

    {
        "code": $code,
        "message": $message,
        "timestamp": $timestamp,
        "data": $data
    }

*More information about [error handling](error-handling.md)*

## Report API
<br>According to different products, you can set the frequency of report sending.<br / >
<br>For example, you set the frequency : 30 seconds<br / >
<br>Every 30 seconds, your device will send a report to the cloud.<br / >

![report](../../img/docs/report.png)

Method: `POST`

Path: `/products/{product_id}/devices/{device_id}/reports`

| Parameter        | Type          | Description                       |
| :--:             | :-----:       | :----                             |
| state            | string        | State of device                   |
| latlng(optional) | string        | Latitude and longitude of device  |
|                  |               | format `latitude:longitude`       |
| c_xxx             | string/number | You can put your custom parameter with prefix `c_` |


Example: Report basic device with location
```http
POST /products/A001/devices/D001/reports

{
    "data":
    {
        "state": "FATAL_ERROR",
        "latitude": 12.321,
        "longitude": -32.12
    }
}
```

Example: Report custom device
```http
POST /products/A001/devices/D001/reports

{
    "data":
    {
        "state": "FATAL_ERROR",
        "c_id": 5512,
        "c_temperature": 52.32,
        "c_t-unit": "Â°C",
        "c_pressure": 1.12,
        "c_p-unit": "atm"
    }
}
```

